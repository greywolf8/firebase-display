<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biomechanical Sensor Data Analysis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBxmQuk_G3xdYqjFlaet1-52etyN95hYAk",
            authDomain: "sensorweb-d2d23.firebaseapp.com",
            databaseURL: "https://sensorweb-d2d23-default-rtdb.firebaseio.com/",
            projectId: "sensorweb-d2d23",
            storageBucket: "sensorweb-d2d23.firebasestorage.app",
            messagingSenderId: "769408603513",
            appId: "1:769408603513:web:03da862c5528cbc9720ba8",
            measurementId: "G-C9FZYZMLGE"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth();

        // Add degrees and radians conversion functions
        Math.degrees = function(radians) {
            return radians * (180/Math.PI);
        };

        Math.toRadians = function(degrees) {
            return degrees * (Math.PI/180);
        };

        let currentSensorData = null;
        const maxDataPoints = 100;
        let charts = {};
        let timeData = [];

        function initializeCharts() {
            const chartConfigs = {
                'femurAccelChart': {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'X-Axis',
                                data: [],
                                borderColor: 'rgb(255, 99, 132)',
                                fill: false
                            },
                            {
                                label: 'Y-Axis',
                                data: [],
                                borderColor: 'rgb(54, 162, 235)',
                                fill: false
                            },
                            {
                                label: 'Z-Axis',
                                data: [],
                                borderColor: 'rgb(75, 192, 192)',
                                fill: false
                            },
                            {
                                label: 'Magnitude',
                                data: [],
                                borderColor: 'rgb(153, 102, 255)',
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Femur Acceleration',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                padding: {
                                    top: 10,
                                    bottom: 10
                                }
                            }
                        },
                        scales: {
                            y: {
                                title: { display: true, text: 'Acceleration (m/s²)' }
                            },
                            x: {
                                title: { display: true, text: 'Time (s)' }
                            }
                        }
                    }
                },
                'femurGyroChart': {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'X-Axis',
                                data: [],
                                borderColor: 'rgb(255, 99, 132)',
                                fill: false
                            },
                            {
                                label: 'Y-Axis',
                                data: [],
                                borderColor: 'rgb(54, 162, 235)',
                                fill: false
                            },
                            {
                                label: 'Z-Axis',
                                data: [],
                                borderColor: 'rgb(75, 192, 192)',
                                fill: false
                            },
                            {
                                label: 'Magnitude',
                                data: [],
                                borderColor: 'rgb(153, 102, 255)',
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Femur Gyroscope',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                padding: {
                                    top: 10,
                                    bottom: 10
                                }
                            }
                        },
                        scales: {
                            y: {
                                title: { display: true, text: 'Angular Velocity (deg/s)' }
                            },
                            x: {
                                title: { display: true, text: 'Time (s)' }
                            }
                        }
                    }
                },
                'tibiaAccelChart': {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'X-Axis',
                                data: [],
                                borderColor: 'rgb(255, 99, 132)',
                                fill: false
                            },
                            {
                                label: 'Y-Axis',
                                data: [],
                                borderColor: 'rgb(54, 162, 235)',
                                fill: false
                            },
                            {
                                label: 'Z-Axis',
                                data: [],
                                borderColor: 'rgb(75, 192, 192)',
                                fill: false
                            },
                            {
                                label: 'Magnitude',
                                data: [],
                                borderColor: 'rgb(153, 102, 255)',
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Tibia Acceleration',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                padding: {
                                    top: 10,
                                    bottom: 10
                                }
                            }
                        },
                        scales: {
                            y: {
                                title: { display: true, text: 'Acceleration (m/s²)' }
                            },
                            x: {
                                title: { display: true, text: 'Time (s)' }
                            }
                        }
                    }
                },
                'tibiaGyroChart': {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'X-Axis',
                                data: [],
                                borderColor: 'rgb(255, 99, 132)',
                                fill: false
                            },
                            {
                                label: 'Y-Axis',
                                data: [],
                                borderColor: 'rgb(54, 162, 235)',
                                fill: false
                            },
                            {
                                label: 'Z-Axis',
                                data: [],
                                borderColor: 'rgb(75, 192, 192)',
                                fill: false
                            },
                            {
                                label: 'Magnitude',
                                data: [],
                                borderColor: 'rgb(153, 102, 255)',
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Tibia Gyroscope',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                padding: {
                                    top: 10,
                                    bottom: 10
                                }
                            }
                        },
                        scales: {
                            y: {
                                title: { display: true, text: 'Angular Velocity (deg/s)' }
                            },
                            x: {
                                title: { display: true, text: 'Time (s)' }
                            }
                        }
                    }
                }
            };

            for (const [chartId, config] of Object.entries(chartConfigs)) {
                const ctx = document.getElementById(chartId).getContext('2d');
                charts[chartId] = new Chart(ctx, config);
            }
        }

        function updateCharts(data, timestamp) {
            if (timeData.length >= maxDataPoints) {
                timeData.shift();
                Object.values(charts).forEach(chart => {
                    chart.data.labels.shift();
                    chart.data.datasets.forEach(dataset => {
                        dataset.data.shift();
                    });
                });
            }

            timeData.push(timestamp);
            const timeLabel = (timestamp % 10).toFixed(1);

            // Add time label to all charts
            Object.values(charts).forEach(chart => {
                chart.data.labels.push(timeLabel);
            });

            // Update Femur Acceleration
            if (data.Femur && data.Femur.Acceleration) {
                const femurAccel = data.Femur.Acceleration;
                charts.femurAccelChart.data.datasets[0].data.push(femurAccel.Femur_Accel_X);
                charts.femurAccelChart.data.datasets[1].data.push(femurAccel.Femur_Accel_Y);
                charts.femurAccelChart.data.datasets[2].data.push(femurAccel.Femur_Accel_Z);
                charts.femurAccelChart.data.datasets[3].data.push(femurAccel.Femur_Accel_Magnitude);
            }

            // Update Femur Gyroscope
            if (data.Femur && data.Femur.Gyroscope) {
                const femurGyro = data.Femur.Gyroscope;
                charts.femurGyroChart.data.datasets[0].data.push(femurGyro.Femur_Gyro_X);
                charts.femurGyroChart.data.datasets[1].data.push(femurGyro.Femur_Gyro_Y);
                charts.femurGyroChart.data.datasets[2].data.push(femurGyro.Femur_Gyro_Z);
                charts.femurGyroChart.data.datasets[3].data.push(femurGyro.Femur_Gyro_Magnitude);
            }

            // Update Tibia Acceleration
            if (data.Tibia && data.Tibia.Acceleration) {
                const tibiaAccel = data.Tibia.Acceleration;
                charts.tibiaAccelChart.data.datasets[0].data.push(tibiaAccel.Tibia_Accel_X);
                charts.tibiaAccelChart.data.datasets[1].data.push(tibiaAccel.Tibia_Accel_Y);
                charts.tibiaAccelChart.data.datasets[2].data.push(tibiaAccel.Tibia_Accel_Z);
                charts.tibiaAccelChart.data.datasets[3].data.push(tibiaAccel.Tibia_Accel_Magnitude);
            }

            // Update Tibia Gyroscope
            if (data.Tibia && data.Tibia.Gyroscope) {
                const tibiaGyro = data.Tibia.Gyroscope;
                charts.tibiaGyroChart.data.datasets[0].data.push(tibiaGyro.Tibia_Gyro_X);
                charts.tibiaGyroChart.data.datasets[1].data.push(tibiaGyro.Tibia_Gyro_Y);
                charts.tibiaGyroChart.data.datasets[2].data.push(tibiaGyro.Tibia_Gyro_Z);
                charts.tibiaGyroChart.data.datasets[3].data.push(tibiaGyro.Tibia_Gyro_Magnitude);
            }

            // Update all charts
            Object.values(charts).forEach(chart => chart.update());
        }

        document.addEventListener("DOMContentLoaded", () => {
            const loginForm = document.getElementById("login-form");
            const logoutButton = document.getElementById("logout-button");
            const dataContainer = document.getElementById("data-container");
            const updateWeightButton = document.getElementById("update-weight-button");

            initializeCharts();

            loginForm.addEventListener("submit", (e) => {
                e.preventDefault();
                const email = document.getElementById("email").value;
                const password = document.getElementById("password").value;

                signInWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        console.log("Logged in successfully:", userCredential.user.email);
                        loginForm.style.display = "none";
                        dataContainer.style.display = "block";
                        loadData();
                    })
                    .catch((error) => {
                        console.error("Login error:", error.message);
                        alert("Login failed: " + error.message);
                    });
            });

            logoutButton.addEventListener("click", () => {
                signOut(auth)
                    .then(() => {
                        loginForm.style.display = "block";
                        dataContainer.style.display = "none";
                    })
                    .catch((error) => {
                        console.error("Logout error:", error.message);
                    });
            });

            
            // Remove auto-login behavior
            loginForm.style.display = "block";
            dataContainer.style.display = "none";

            const weightInput = document.getElementById("user-weight");
            
            // Function to update all weight-dependent calculations
            function updateWeightDependentCalculations() {
                if (currentSensorData) {
                    // Update knee force if acceleration data exists
                    if (currentSensorData.Femur && currentSensorData.Femur.Acceleration) {
                        updateKneeForce(currentSensorData.Femur.Acceleration);
                    }
                    
                    // Update torque if gyroscope data exists
                    if (currentSensorData.Femur && currentSensorData.Femur.Gyroscope && 
                        currentSensorData.Femur.Acceleration) {
                        const femurGyroX = currentSensorData.Femur.Gyroscope.Femur_Gyro_X;
                        const femurGyroY = currentSensorData.Femur.Gyroscope.Femur_Gyro_Y;
                        const femurGyroZ = currentSensorData.Femur.Gyroscope.Femur_Gyro_Z;
                        const femurAngularVelocity = Math.sqrt(
                            femurGyroX * femurGyroX + 
                            femurGyroY * femurGyroY + 
                            femurGyroZ * femurGyroZ
                        );
                        
                        const alpha = femurAngularVelocity / 0.01;  // Angular acceleration
                        const mass = parseFloat(weightInput.value);
                        
                        if (mass && mass > 0) {
                            const accelMag = currentSensorData.Femur.Acceleration.Femur_Accel_Magnitude;
                            const I = mass * (accelMag / 9.81);
                            const torque = I * alpha;
                            
                            document.getElementById("joint-torque-display").textContent = 
                                `Knee Joint Torque: ${Math.abs(torque).toFixed(2)} N·m`;
                        } else {
                            document.getElementById("joint-torque-display").textContent = 
                                `Knee Joint Torque: Please enter valid weight`;
                        }
                    }
                }
            }
            
            // Add real-time weight input listener
            weightInput.addEventListener("input", updateWeightDependentCalculations);
            
            // Update when button is clicked
            updateWeightButton.addEventListener("click", updateWeightDependentCalculations);

            function updateKneeForce(accelerationData) {
                const weightInput = document.getElementById("user-weight").value;
                if (weightInput && weightInput > 0) {
                    const mass = parseFloat(weightInput);
                    const ax = accelerationData.Femur_Accel_X;
                    const ay = accelerationData.Femur_Accel_Y;
                    const az = accelerationData.Femur_Accel_Z;
                    const Afoot = Math.sqrt(ax * ax + ay * ay + az * az);
                    const g = 9.81; // gravity constant in m/s²
                    const Fk = mass * g * Afoot;
                    document.getElementById("knee-force-display").textContent =
                        `Knee Joint Force: ${Fk.toFixed(2)} N`;
                } else {
                    alert("Please enter a valid weight value greater than 0");
                }
            }

            function loadData() {
                const tableBody = document.getElementById("data-table");
                const dbRef = ref(database, "/");
                let startTime = Date.now() / 1000;

                onValue(dbRef, (snapshot) => {
                    const data = snapshot.val();
                    currentSensorData = data;
                    const currentTime = (Date.now() / 1000) - startTime;

                    updateCharts(data, currentTime);
                    
                    // Update Angular Measurements
                    if (data.Femur && data.Femur.Gyroscope && data.Tibia && data.Tibia.Gyroscope && 
                        data.Femur.Acceleration && data.Femur.Acceleration.Femur_Accel_Magnitude) {
                        // Calculate Femur Angular Velocity
                        const femurGyroX = data.Femur.Gyroscope.Femur_Gyro_X;
                        const femurGyroY = data.Femur.Gyroscope.Femur_Gyro_Y;
                        const femurGyroZ = data.Femur.Gyroscope.Femur_Gyro_Z;
                        const femurAngularVelocity = Math.sqrt(
                            femurGyroX * femurGyroX + 
                            femurGyroY * femurGyroY + 
                            femurGyroZ * femurGyroZ
                        );
                        
                        // Calculate Tibia Angular Velocity
                        const tibiaGyroX = data.Tibia.Gyroscope.Tibia_Gyro_X;
                        const tibiaGyroY = data.Tibia.Gyroscope.Tibia_Gyro_Y;
                        const tibiaGyroZ = data.Tibia.Gyroscope.Tibia_Gyro_Z;
                        const tibiaAngularVelocity = Math.sqrt(
                            tibiaGyroX * tibiaGyroX + 
                            tibiaGyroY * tibiaGyroY + 
                            tibiaGyroZ * tibiaGyroZ
                        );

                        document.getElementById("femur-angular-velocity-display").textContent = 
                            `Femur Angular Velocity: ${femurAngularVelocity.toFixed(2)} deg/s`;
                        document.getElementById("tibia-angular-velocity-display").textContent = 
                            `Tibia Angular Velocity: ${tibiaAngularVelocity.toFixed(2)} deg/s`;
                        
                        // Use femur angular velocity for acceleration calculation
                        const alpha = femurAngularVelocity / 0.01;  // Angular acceleration in deg/s²
                        document.getElementById("angular-acceleration-display").textContent = 
                            `Angular Acceleration: ${alpha.toFixed(2)} deg/s²`;
                        
                        // Update all weight-dependent calculations
                        updateWeightDependentCalculations();
                    }

                    // Update Phase
                    if (data.Femur && data.Femur.Acceleration) {
                        const Atotal = data.Femur.Acceleration.Femur_Accel_Magnitude;
                        const phase = Atotal > 1.2 ? "Stance" : "Swing";
                        document.getElementById("phase-display").textContent = 
                            `Phase: ${phase}`;
                    }

                    // Update Foot Orientation using Tibia acceleration
                    if (data.Tibia && data.Tibia.Acceleration && data.Tibia.Gyroscope &&
                        data.Femur && data.Femur.Acceleration && data.Femur.Gyroscope) {
                        // Tibia Orientation
                        const tibiaAccelX = data.Tibia.Acceleration.Tibia_Accel_X;
                        const tibiaAccelY = data.Tibia.Acceleration.Tibia_Accel_Y;
                        const tibiaAccelZ = data.Tibia.Acceleration.Tibia_Accel_Z;
                        const tibiaGyroX = data.Tibia.Gyroscope.Tibia_Gyro_X;
                        const tibiaGyroY = data.Tibia.Gyroscope.Tibia_Gyro_Y;
                        
                        const tibiaPitch = Math.degrees(Math.atan2(-tibiaAccelX, Math.sqrt(tibiaAccelY**2 + tibiaAccelZ**2)));
                        const tibiaRoll = Math.degrees(Math.atan2(tibiaAccelY, tibiaAccelZ));
                        const tibiaYaw = Math.degrees(Math.atan2(tibiaGyroY, tibiaGyroX));
                        
                        // Femur Orientation
                        const femurAccelX = data.Femur.Acceleration.Femur_Accel_X;
                        const femurAccelY = data.Femur.Acceleration.Femur_Accel_Y;
                        const femurAccelZ = data.Femur.Acceleration.Femur_Accel_Z;
                        const femurGyroX = data.Femur.Gyroscope.Femur_Gyro_X;
                        const femurGyroY = data.Femur.Gyroscope.Femur_Gyro_Y;
                        
                        const femurPitch = Math.degrees(Math.atan2(-femurAccelX, Math.sqrt(femurAccelY**2 + femurAccelZ**2)));
                        const femurRoll = Math.degrees(Math.atan2(femurAccelY, femurAccelZ));
                        const femurYaw = Math.degrees(Math.atan2(femurGyroY, femurGyroX));
                        
                        // Calculate relative knee flexion angle using vector approach
                        function calculateKneeFlexionAngle(femurAngles, tibiaAngles) {
                            console.log('Input angles:', { femurAngles, tibiaAngles });

                            // Normalize angles to be within -180 to 180 degrees
                            const normalizePitch = (pitch) => {
                                let p = pitch % 360;
                                return p > 180 ? p - 360 : (p < -180 ? p + 360 : p);
                            };

                            femurAngles.pitch = normalizePitch(femurAngles.pitch);
                            tibiaAngles.pitch = normalizePitch(tibiaAngles.pitch);

                            // Create unit vectors for femur and tibia
                            // Using pitch only for initial testing as it's the primary angle for knee flexion
                            let femurVector = [
                                Math.sin(Math.toRadians(femurAngles.pitch)),
                                0,  // Assuming sagittal plane motion
                                Math.cos(Math.toRadians(femurAngles.pitch))
                            ];

                            let tibiaVector = [
                                Math.sin(Math.toRadians(tibiaAngles.pitch)),
                                0,  // Assuming sagittal plane motion
                                Math.cos(Math.toRadians(tibiaAngles.pitch))
                            ];

                            console.log('Vectors:', {
                                femurVector,
                                tibiaVector
                            });

                            // Compute dot product
                            let dotProduct = femurVector[0] * tibiaVector[0] +
                                           femurVector[1] * tibiaVector[1] +
                                           femurVector[2] * tibiaVector[2];

                            // Ensure dot product is within valid range for acos
                            dotProduct = Math.max(-1, Math.min(1, dotProduct));

                            // Compute knee flexion angle (in degrees)
                            let kneeAngle = Math.degrees(Math.acos(dotProduct));

                            // The angle should be positive during flexion
                            // If tibia pitch is greater than femur pitch, we're in flexion
                            if (tibiaAngles.pitch < femurAngles.pitch) {
                                kneeAngle = 180 - kneeAngle;
                            }

                            console.log('Calculated values:', {
                                dotProduct,
                                kneeAngle
                            });

                            return Math.abs(kneeAngle).toFixed(2);
                        }

                        // Update displays for Tibia
                        document.getElementById("tibia-pitch-display").textContent = 
                            `Tibia Pitch: ${tibiaPitch.toFixed(2)}°`;
                        document.getElementById("tibia-roll-display").textContent = 
                            `Tibia Roll: ${tibiaRoll.toFixed(2)}°`;
                        document.getElementById("tibia-yaw-display").textContent = 
                            `Tibia Yaw: ${tibiaYaw.toFixed(2)}°`;
                            
                        // Update displays for Femur
                        document.getElementById("femur-pitch-display").textContent = 
                            `Femur Pitch: ${femurPitch.toFixed(2)}°`;
                        document.getElementById("femur-roll-display").textContent = 
                            `Femur Roll: ${femurRoll.toFixed(2)}°`;
                        document.getElementById("femur-yaw-display").textContent = 
                            `Femur Yaw: ${femurYaw.toFixed(2)}°`;
                            
                        // Calculate knee flexion angle using the new vector-based approach
                        const femurAngles = { pitch: femurPitch, yaw: femurYaw };
                        const tibiaAngles = { pitch: tibiaPitch, yaw: tibiaYaw };
                        const kneeFlexionAngle = calculateKneeFlexionAngle(femurAngles, tibiaAngles);
                        document.getElementById("knee-flexion-display").textContent = 
                            `Knee Flexion Angle: ${kneeFlexionAngle}°`;
                    }

                    // Update raw data table
                    tableBody.innerHTML = "";
                    if (!data) {
                        tableBody.innerHTML = "<tr><td colspan='3'>No data available</td></tr>";
                        return;
                    }

                    for (const segment in data) {
                        for (const sensorType in data[segment]) {
                            const row = document.createElement("tr");
                            const segmentCell = document.createElement("td");
                            segmentCell.textContent = segment;
                            const sensorTypeCell = document.createElement("td");
                            sensorTypeCell.textContent = sensorType;
                            const dataCell = document.createElement("td");
                            const sensorData = data[segment][sensorType];
                            dataCell.textContent = JSON.stringify(sensorData);

                            row.appendChild(segmentCell);
                            row.appendChild(sensorTypeCell);
                            row.appendChild(dataCell);
                            tableBody.appendChild(row);
                        }
                    }
                });
            }
        });
    </script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-image: url('https://img.freepik.com/free-vector/network-mesh-wire-digital-technology-background_1017-27428.jpg');
            background-size: cover;
            background-position: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .data-display {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .btn-primary {
            background-color: #4CAF50;
            border-color: #4CAF50;
        }

        .btn-primary:hover {
            background-color: #45a049;
            border-color: #45a049;
        }

        table {
            width: 100%;
            margin-top: 20px;
        }

        th {
            background-color: #4CAF50;
            color: white;
        }

        .biomech-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .weight-input-group {
            display: flex;
            gap: 10px;
            align-items: start;
        }

        .weight-input-group .form-control {
            flex: 1;
        }
        .chart-container {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            height: 300px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center text-white bg-dark p-3 rounded mb-4">Biomechanical Sensor Analysis</h1>

        <form id="login-form" class="card p-4 mx-auto" style="max-width: 400px;">
            <h2 class="text-center mb-4">Login</h2>
            <div class="mb-3">
                <input type="email" id="email" class="form-control" placeholder="Email" required />
            </div>
            <div class="mb-3">
                <input type="password" id="password" class="form-control" placeholder="Password" required />
            </div>
            <button type="submit" class="btn btn-primary w-100">Login</button>
        </form>

        <div id="data-container" style="display: none;">
            <div class="d-flex justify-content-end mb-3">
                <button id="logout-button" class="btn btn-danger">Logout</button>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="biomech-section">
                        <h3>Gait Analysis</h3>
                        <div class="mb-3">
                            <label for="user-weight" class="form-label">Enter Your Weight (kg):</label>
                            <div class="weight-input-group">
                                <input type="number" id="user-weight" class="form-control" placeholder="e.g. 70" min="1" required>
                                <button type="button" id="update-weight-button" class="btn btn-primary">Update</button>
                            </div>
                        </div>
                        <div id="phase-display" class="data-display">Phase: Loading...</div>
                        <div id="knee-force-display" class="data-display">Knee Joint Force: Loading...</div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="biomech-section">
                        <h3>Angular Measurements</h3>
                        <div id="femur-angular-velocity-display" class="data-display">Femur Angular Velocity: Loading...</div>
                        <div id="tibia-angular-velocity-display" class="data-display">Tibia Angular Velocity: Loading...</div>
                        <div id="angular-acceleration-display" class="data-display">Angular Acceleration: Loading...</div>
                        <div id="joint-torque-display" class="data-display">Knee Joint Torque: Loading...</div>
                    </div>
                </div>
            </div>

            <div class="biomech-section">
                <h3>Segment Orientations</h3>
                <div class="row">
                    <div class="col-md-6">
                        <h4 class="text-center">Femur Orientation</h4>
                        <div id="femur-pitch-display" class="data-display">Femur Pitch: Loading...</div>
                        <div id="femur-roll-display" class="data-display">Femur Roll: Loading...</div>
                        <div id="femur-yaw-display" class="data-display">Femur Yaw: Loading...</div>
                    </div>
                    <div class="col-md-6">
                        <h4 class="text-center">Tibia Orientation</h4>
                        <div id="tibia-pitch-display" class="data-display">Tibia Pitch: Loading...</div>
                        <div id="tibia-roll-display" class="data-display">Tibia Roll: Loading...</div>
                        <div id="tibia-yaw-display" class="data-display">Tibia Yaw: Loading...</div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <div id="knee-flexion-display" class="data-display">Knee Flexion Angle: Loading...</div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="chart-container">
                        <canvas id="femurAccelChart"></canvas>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="chart-container">
                        <canvas id="femurGyroChart"></canvas>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="chart-container">
                        <canvas id="tibiaAccelChart"></canvas>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="chart-container">
                        <canvas id="tibiaGyroChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="mb-0">Raw Sensor Data</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Section</th>
                                    <th>Sensor Type</th>
                                    <th>Data</th>
                                </tr>
                            </thead>
                            <tbody id="data-table">
                                <!-- Data will be dynamically populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html> 
