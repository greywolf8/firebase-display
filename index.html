<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biomechanical Sensor Data Analysis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBxmQuk_G3xdYqjFlaet1-52etyN95hYAk",
            authDomain: "sensorweb-d2d23.firebaseapp.com",
            databaseURL: "https://sensorweb-d2d23-default-rtdb.firebaseio.com/",
            projectId: "sensorweb-d2d23",
            storageBucket: "sensorweb-d2d23.firebasestorage.app",
            messagingSenderId: "769408603513",
            appId: "1:769408603513:web:03da862c5528cbc9720ba8",
            measurementId: "G-C9FZYZMLGE"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth();

        // Add degrees and radians conversion functions
        Math.degrees = function(radians) {
            return radians * (180/Math.PI);
        };

        Math.toRadians = function(degrees) {
            return degrees * (Math.PI/180);
        };

        let currentSensorData = null;
        const maxDataPoints = 100;
        let charts = {};
        let timeData = [];

        function initializeCharts() {
            const chartConfigs = {
                'femurAccelChart': {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'X-Axis',
                                data: [],
                                borderColor: 'rgb(255, 99, 132)',
                                fill: false
                            },
                            {
                                label: 'Y-Axis',
                                data: [],
                                borderColor: 'rgb(54, 162, 235)',
                                fill: false
                            },
                            {
                                label: 'Z-Axis',
                                data: [],
                                borderColor: 'rgb(75, 192, 192)',
                                fill: false
                            },
                            {
                                label: 'Magnitude',
                                data: [],
                                borderColor: 'rgb(153, 102, 255)',
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Femur Acceleration',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                padding: {
                                    top: 10,
                                    bottom: 10
                                }
                            }
                        },
                        scales: {
                            y: {
                                title: { display: true, text: 'Acceleration (m/s²)' }
                            },
                            x: {
                                title: { display: true, text: 'Time (s)' }
                            }
                        }
                    }
                },
                'femurGyroChart': {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'X-Axis',
                                data: [],
                                borderColor: 'rgb(255, 99, 132)',
                                fill: false
                            },
                            {
                                label: 'Y-Axis',
                                data: [],
                                borderColor: 'rgb(54, 162, 235)',
                                fill: false
                            },
                            {
                                label: 'Z-Axis',
                                data: [],
                                borderColor: 'rgb(75, 192, 192)',
                                fill: false
                            },
                            {
                                label: 'Magnitude',
                                data: [],
                                borderColor: 'rgb(153, 102, 255)',
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Femur Gyroscope',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                padding: {
                                    top: 10,
                                    bottom: 10
                                }
                            }
                        },
                        scales: {
                            y: {
                                title: { display: true, text: 'Angular Velocity (deg/s)' }
                            },
                            x: {
                                title: { display: true, text: 'Time (s)' }
                            }
                        }
                    }
                },
                'tibiaAccelChart': {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'X-Axis',
                                data: [],
                                borderColor: 'rgb(255, 99, 132)',
                                fill: false
                            },
                            {
                                label: 'Y-Axis',
                                data: [],
                                borderColor: 'rgb(54, 162, 235)',
                                fill: false
                            },
                            {
                                label: 'Z-Axis',
                                data: [],
                                borderColor: 'rgb(75, 192, 192)',
                                fill: false
                            },
                            {
                                label: 'Magnitude',
                                data: [],
                                borderColor: 'rgb(153, 102, 255)',
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Tibia Acceleration',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                padding: {
                                    top: 10,
                                    bottom: 10
                                }
                            }
                        },
                        scales: {
                            y: {
                                title: { display: true, text: 'Acceleration (m/s²)' }
                            },
                            x: {
                                title: { display: true, text: 'Time (s)' }
                            }
                        }
                    }
                },
                'tibiaGyroChart': {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'X-Axis',
                                data: [],
                                borderColor: 'rgb(255, 99, 132)',
                                fill: false
                            },
                            {
                                label: 'Y-Axis',
                                data: [],
                                borderColor: 'rgb(54, 162, 235)',
                                fill: false
                            },
                            {
                                label: 'Z-Axis',
                                data: [],
                                borderColor: 'rgb(75, 192, 192)',
                                fill: false
                            },
                            {
                                label: 'Magnitude',
                                data: [],
                                borderColor: 'rgb(153, 102, 255)',
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Tibia Gyroscope',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                padding: {
                                    top: 10,
                                    bottom: 10
                                }
                            }
                        },
                        scales: {
                            y: {
                                title: { display: true, text: 'Angular Velocity (deg/s)' }
                            },
                            x: {
                                title: { display: true, text: 'Time (s)' }
                            }
                        }
                    }
                }
            };

            for (const [chartId, config] of Object.entries(chartConfigs)) {
                const ctx = document.getElementById(chartId).getContext('2d');
                charts[chartId] = new Chart(ctx, config);
            }
        }

        function updateCharts(data, timestamp) {
            if (timeData.length >= maxDataPoints) {
                timeData.shift();
                Object.values(charts).forEach(chart => {
                    chart.data.labels.shift();
                    chart.data.datasets.forEach(dataset => {
                        dataset.data.shift();
                    });
                });
            }

            timeData.push(timestamp);
            const timeLabel = (timestamp % 10).toFixed(1);

            // Add time label to all charts
            Object.values(charts).forEach(chart => {
                chart.data.labels.push(timeLabel);
            });

            // Update Femur Acceleration
            if (data.Femur && data.Femur.Acceleration) {
                const femurAccel = data.Femur.Acceleration;
                charts.femurAccelChart.data.datasets[0].data.push(femurAccel.Femur_Accel_X);
                charts.femurAccelChart.data.datasets[1].data.push(femurAccel.Femur_Accel_Y);
                charts.femurAccelChart.data.datasets[2].data.push(femurAccel.Femur_Accel_Z);
                charts.femurAccelChart.data.datasets[3].data.push(femurAccel.Femur_Accel_Magnitude);
            }

            // Update Femur Gyroscope
            if (data.Femur && data.Femur.Gyroscope) {
                const femurGyro = data.Femur.Gyroscope;
                charts.femurGyroChart.data.datasets[0].data.push(femurGyro.Femur_Gyro_X);
                charts.femurGyroChart.data.datasets[1].data.push(femurGyro.Femur_Gyro_Y);
                charts.femurGyroChart.data.datasets[2].data.push(femurGyro.Femur_Gyro_Z);
                charts.femurGyroChart.data.datasets[3].data.push(femurGyro.Femur_Gyro_Magnitude);
            }

            // Update Tibia Acceleration
            if (data.Tibia && data.Tibia.Acceleration) {
                const tibiaAccel = data.Tibia.Acceleration;
                charts.tibiaAccelChart.data.datasets[0].data.push(tibiaAccel.Tibia_Accel_X);
                charts.tibiaAccelChart.data.datasets[1].data.push(tibiaAccel.Tibia_Accel_Y);
                charts.tibiaAccelChart.data.datasets[2].data.push(tibiaAccel.Tibia_Accel_Z);
                charts.tibiaAccelChart.data.datasets[3].data.push(tibiaAccel.Tibia_Accel_Magnitude);
            }

            // Update Tibia Gyroscope
            if (data.Tibia && data.Tibia.Gyroscope) {
                const tibiaGyro = data.Tibia.Gyroscope;
                charts.tibiaGyroChart.data.datasets[0].data.push(tibiaGyro.Tibia_Gyro_X);
                charts.tibiaGyroChart.data.datasets[1].data.push(tibiaGyro.Tibia_Gyro_Y);
                charts.tibiaGyroChart.data.datasets[2].data.push(tibiaGyro.Tibia_Gyro_Z);
                charts.tibiaGyroChart.data.datasets[3].data.push(tibiaGyro.Tibia_Gyro_Magnitude);
            }

            // Update all charts
            Object.values(charts).forEach(chart => chart.update());
        }

        document.addEventListener("DOMContentLoaded", () => {
            const loginForm = document.getElementById("login-form");
            const logoutButton = document.getElementById("logout-button");
            const dataContainer = document.getElementById("data-container");
            const updateWeightButton = document.getElementById("update-weight-button");

            initializeCharts();

            loginForm.addEventListener("submit", (e) => {
                e.preventDefault();
                const email = document.getElementById("email").value;
                const password = document.getElementById("password").value;

                signInWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        console.log("Logged in successfully:", userCredential.user.email);
                        loginForm.style.display = "none";
                        dataContainer.style.display = "block";
                        loadData();
                    })
                    .catch((error) => {
                        console.error("Login error:", error.message);
                        alert("Login failed: " + error.message);
                    });
            });

            logoutButton.addEventListener("click", () => {
                signOut(auth)
                    .then(() => {
                        loginForm.style.display = "block";
                        dataContainer.style.display = "none";
                    })
                    .catch((error) => {
                        console.error("Logout error:", error.message);
                    });
            });

            
            // Remove auto-login behavior
            loginForm.style.display = "block";
            dataContainer.style.display = "none";

            const weightInput = document.getElementById("user-weight");
            
            // Function to update all weight-dependent calculations
            function updateWeightDependentCalculations() {
                if (currentSensorData) {
                    // Update knee force if acceleration data exists
                    if (currentSensorData.Femur && currentSensorData.Femur.Acceleration) {
                        updateKneeForce(currentSensorData.Femur.Acceleration);
                    }
                    
                    // Update torque if gyroscope data exists
                    if (currentSensorData.Femur && currentSensorData.Femur.Gyroscope && 
                        currentSensorData.Femur.Acceleration) {
                        const femurGyroX = currentSensorData.Femur.Gyroscope.Femur_Gyro_X;
                        const femurGyroY = currentSensorData.Femur.Gyroscope.Femur_Gyro_Y;
                        const femurGyroZ = currentSensorData.Femur.Gyroscope.Femur_Gyro_Z;
                        const femurAngularVelocity = Math.sqrt(
                            femurGyroX * femurGyroX + 
                            femurGyroY * femurGyroY + 
                            femurGyroZ * femurGyroZ
                        );
                        
                        const alpha = femurAngularVelocity / 0.01;  // Angular acceleration
                        const mass = parseFloat(weightInput.value);
                        
                        if (mass && mass > 0) {
                            const accelMag = currentSensorData.Femur.Acceleration.Femur_Accel_Magnitude;
                            const I = mass * (accelMag / 9.81);
                            const torque = I * alpha;
                            
                            document.getElementById("joint-torque-display").textContent = 
                                `Knee Joint Torque: ${Math.abs(torque).toFixed(2)} N·m`;
                        } else {
                            document.getElementById("joint-torque-display").textContent = 
                                `Knee Joint Torque: Please enter valid weight`;
                        }
                    }
                }
            }
            
            // Add real-time weight input listener
            weightInput.addEventListener("input", updateWeightDependentCalculations);
            
            // Update when button is clicked
            updateWeightButton.addEventListener("click", updateWeightDependentCalculations);

            function updateKneeForce(accelerationData) {
                const weightInput = document.getElementById("user-weight").value;
                if (weightInput && weightInput > 0) {
                    const mass = parseFloat(weightInput);
                    const ax = accelerationData.Femur_Accel_X;
                    const ay = accelerationData.Femur_Accel_Y;
                    const az = accelerationData.Femur_Accel_Z;
                    const Afoot = Math.sqrt(ax * ax + ay * ay + az * az);
                    const g = 9.81; // gravity constant in m/s²
                    const Fk = mass * g * Afoot;
                    document.getElementById("knee-force-display").textContent =
                        `Knee Joint Force: ${Fk.toFixed(2)} N`;
                } else {
                    alert("Please enter a valid weight value greater than 0");
                }
            }

            function loadData() {
                const tableBody = document.getElementById("data-table");
                const dbRef = ref(database, "/");
                let startTime = Date.now() / 1000;

                onValue(dbRef, (snapshot) => {
                    const data = snapshot.val();
                    currentSensorData = data;
                    const currentTime = (Date.now() / 1000) - startTime;

                    updateCharts(data, currentTime);
                    
                    // Update Angular Measurements
                    if (data.Femur && data.Femur.Gyroscope && data.Tibia && data.Tibia.Gyroscope && 
                        data.Femur.Acceleration && data.Femur.Acceleration.Femur_Accel_Magnitude) {
                        // Calculate Femur Angular Velocity
                        const femurGyroX = data.Femur.Gyroscope.Femur_Gyro_X;
                        const femurGyroY = data.Femur.Gyroscope.Femur_Gyro_Y;
                        const femurGyroZ = data.Femur.Gyroscope.Femur_Gyro_Z;
                        const femurAngularVelocity = Math.sqrt(
                            femurGyroX * femurGyroX + 
                            femurGyroY * femurGyroY + 
                            femurGyroZ * femurGyroZ
                        );
                        
                        // Calculate Tibia Angular Velocity
                        const tibiaGyroX = data.Tibia.Gyroscope.Tibia_Gyro_X;
                        const tibiaGyroY = data.Tibia.Gyroscope.Tibia_Gyro_Y;
                        const tibiaGyroZ = data.Tibia.Gyroscope.Tibia_Gyro_Z;
                        const tibiaAngularVelocity = Math.sqrt(
                            tibiaGyroX * tibiaGyroX + 
                            tibiaGyroY * tibiaGyroY + 
                            tibiaGyroZ * tibiaGyroZ
                        );

                        document.getElementById("femur-angular-velocity-display").textContent = 
                            `Femur Angular Velocity: ${femurAngularVelocity.toFixed(2)} deg/s`;
                        document.getElementById("tibia-angular-velocity-display").textContent = 
                            `Tibia Angular Velocity: ${tibiaAngularVelocity.toFixed(2)} deg/s`;
                        
                        // Use femur angular velocity for acceleration calculation
                        const alpha = femurAngularVelocity / 0.01;  // Angular acceleration in deg/s²
                        document.getElementById("angular-acceleration-display").textContent = 
                            `Angular Acceleration: ${alpha.toFixed(2)} deg/s²`;
                        
                        // Update all weight-dependent calculations
                        updateWeightDependentCalculations();
                    }

                    // Update Phase
                    if (data.Femur && data.Femur.Acceleration) {
                        const Atotal = data.Femur.Acceleration.Femur_Accel_Magnitude;
                        const phase = Atotal > 1.2 ? "Stance" : "Swing";
                        document.getElementById("phase-display").textContent = 
                            `Phase: ${phase}`;
                    }

                    // Update Foot Orientation using Tibia acceleration
                    if (data.Tibia && data.Tibia.Acceleration && data.Tibia.Gyroscope &&
                        data.Femur && data.Femur.Acceleration && data.Femur.Gyroscope) {
                        // Tibia Orientation
                        const tibiaAccelX = data.Tibia.Acceleration.Tibia_Accel_X;
                        const tibiaAccelY = data.Tibia.Acceleration.Tibia_Accel_Y;
                        const tibiaAccelZ = data.Tibia.Acceleration.Tibia_Accel_Z;
                        const tibiaGyroX = data.Tibia.Gyroscope.Tibia_Gyro_X;
                        const tibiaGyroY = data.Tibia.Gyroscope.Tibia_Gyro_Y;
                        
                        const tibiaPitch = Math.degrees(Math.atan2(-tibiaAccelX, Math.sqrt(tibiaAccelY**2 + tibiaAccelZ**2)));
                        const tibiaRoll = Math.degrees(Math.atan2(tibiaAccelY, tibiaAccelZ));
                        const tibiaYaw = Math.degrees(Math.atan2(tibiaGyroY, tibiaGyroX));
                        
                        // Femur Orientation
                        const femurAccelX = data.Femur.Acceleration.Femur_Accel_X;
                        const femurAccelY = data.Femur.Acceleration.Femur_Accel_Y;
                        const femurAccelZ = data.Femur.Acceleration.Femur_Accel_Z;
                        const femurGyroX = data.Femur.Gyroscope.Femur_Gyro_X;
                        const femurGyroY = data.Femur.Gyroscope.Femur_Gyro_Y;
                        
                        const femurPitch = Math.degrees(Math.atan2(-femurAccelX, Math.sqrt(femurAccelY**2 + femurAccelZ**2)));
                        const femurRoll = Math.degrees(Math.atan2(femurAccelY, femurAccelZ));
                        const femurYaw = Math.degrees(Math.atan2(femurGyroY, femurGyroX));
                        
                        // Calculate relative knee flexion angle using vector approach
                        function calculateKneeFlexionAngle(femurAngles, tibiaAngles) {
                            console.log('Input angles:', { femurAngles, tibiaAngles });

                            // Normalize angles to be within -180 to 180 degrees
                            const normalizePitch = (pitch) => {
                                let p = pitch % 360;
                                return p > 180 ? p - 360 : (p < -180 ? p + 360 : p);
                            };

                            femurAngles.pitch = normalizePitch(femurAngles.pitch);
                            tibiaAngles.pitch = normalizePitch(tibiaAngles.pitch);

                            // Create unit vectors for femur and tibia
                            // Using pitch only for initial testing as it's the primary angle for knee flexion
                            let femurVector = [
                                Math.sin(Math.toRadians(femurAngles.pitch)),
                                0,  // Assuming sagittal plane motion
                                Math.cos(Math.toRadians(femurAngles.pitch))
                            ];

                            let tibiaVector = [
                                Math.sin(Math.toRadians(tibiaAngles.pitch)),
                                0,  // Assuming sagittal plane motion
                                Math.cos(Math.toRadians(tibiaAngles.pitch))
                            ];

                            console.log('Vectors:', {
                                femurVector,
                                tibiaVector
                            });

                            // Compute dot product
                            let dotProduct = femurVector[0] * tibiaVector[0] +
                                           femurVector[1] * tibiaVector[1] +
                                           femurVector[2] * tibiaVector[2];

                            // Ensure dot product is within valid range for acos
                            dotProduct = Math.max(-1, Math.min(1, dotProduct));

                            // Compute knee flexion angle (in degrees)
                            let kneeAngle = Math.degrees(Math.acos(dotProduct));

                            // The angle should be positive during flexion
                            // If tibia pitch is greater than femur pitch, we're in flexion
                            if (tibiaAngles.pitch < femurAngles.pitch) {
                                kneeAngle = 180 - kneeAngle;
                            }

                            console.log('Calculated values:', {
                                dotProduct,
                                kneeAngle
                            });

                            return Math.abs(kneeAngle).toFixed(2);
                        }

                        // Update displays for Tibia
                        document.getElementById("tibia-pitch-display").textContent = 
                            `Tibia Pitch: ${tibiaPitch.toFixed(2)}°`;
                        document.getElementById("tibia-roll-display").textContent = 
                            `Tibia Roll: ${tibiaRoll.toFixed(2)}°`;
                        document.getElementById("tibia-yaw-display").textContent = 
                            `Tibia Yaw: ${tibiaYaw.toFixed(2)}°`;
                            
                        // Update displays for Femur
                        document.getElementById("femur-pitch-display").textContent = 
                            `Femur Pitch: ${femurPitch.toFixed(2)}°`;
                        document.getElementById("femur-roll-display").textContent = 
                            `Femur Roll: ${femurRoll.toFixed(2)}°`;
                        document.getElementById("femur-yaw-display").textContent = 
                            `Femur Yaw: ${femurYaw.toFixed(2)}°`;
                            
                        // Calculate knee flexion angle using the new vector-based approach
                        const femurAngles = { pitch: femurPitch, yaw: femurYaw };
                        const tibiaAngles = { pitch: tibiaPitch, yaw: tibiaYaw };
                        const kneeFlexionAngle = calculateKneeFlexionAngle(femurAngles, tibiaAngles);
                        document.getElementById("knee-flexion-display").textContent = 
                            `Knee Flexion Angle: ${kneeFlexionAngle}°`;
                    }

                    // Update raw data table
                    tableBody.innerHTML = "";
                    if (!data) {
                        tableBody.innerHTML = "<tr><td colspan='3'>No data available</td></tr>";
                        return;
                    }

                    for (const segment in data) {
                        for (const sensorType in data[segment]) {
                            const row = document.createElement("tr");
                            const segmentCell = document.createElement("td");
                            segmentCell.textContent = segment;
                            const sensorTypeCell = document.createElement("td");
                            sensorTypeCell.textContent = sensorType;
                            const dataCell = document.createElement("td");
                            const sensorData = data[segment][sensorType];
                            dataCell.textContent = JSON.stringify(sensorData);

                            row.appendChild(segmentCell);
                            row.appendChild(sensorTypeCell);
                            row.appendChild(dataCell);
                            tableBody.appendChild(row);
                        }
                    }
                });
            }
        });
    </script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --background-color: #f5f6fa;
            --card-bg: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
        }

        body {
            font-family: 'Segoe UI', 'Arial', sans-serif;
            background: linear-gradient(rgba(245, 246, 250, 0.6), rgba(245, 246, 250, 0.6)),
                        url('https://img.freepik.com/free-vector/network-mesh-wire-digital-technology-background_1017-27428.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: var(--text-primary);
        }

        .card, .biomech-section, .chart-container, .data-display, #login-form {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .dashboard-header {
            background: linear-gradient(135deg, rgba(44, 62, 80, 0.85), rgba(52, 152, 219, 0.85));
            backdrop-filter: blur(5px);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .dashboard-header h1 {
            margin: 0;
            font-size: 2.2rem;
            font-weight: 600;
        }

        .card {
            border: none;
            border-radius: 15px;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            background: transparent;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
        }

        .card-header h3 {
            color: var(--primary-color);
            font-size: 1.4rem;
            margin: 0;
        }

        .data-display {
            padding: 1.2rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--secondary-color);
            font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .chart-container {
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 1.5rem;
            height: 350px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .btn-primary {
            background: rgba(52, 152, 219, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }

        .btn-primary:hover {
            background: rgba(41, 128, 185, 0.95);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: rgba(231, 76, 60, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }

        .btn-danger:hover {
            background: rgba(231, 76, 60, 0.95);
            transform: translateY(-2px);
        }

        .weight-input-group {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .weight-input-group .form-control {
            border-radius: 8px;
            padding: 0.8rem;
            border: 1px solid #e1e1e1;
        }

        .biomech-section {
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .biomech-section h3 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .table {
            border-radius: 10px;
            overflow: hidden;
        }

        .table thead th {
            background: rgba(44, 62, 80, 0.85);
            color: white;
            font-weight: 500;
            border: none;
            padding: 1rem;
            backdrop-filter: blur(5px);
        }

        .table tbody td {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(5px);
            padding: 1rem;
            vertical-align: middle;
        }

        /* Login Form Styling */
        #login-form {
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        #login-form h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        #login-form .form-control {
            padding: 0.8rem;
            border-radius: 8px;
            border: 1px solid #e1e1e1;
            margin-bottom: 1rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .dashboard-header {
                padding: 1.5rem;
            }
            
            .dashboard-header h1 {
                font-size: 1.8rem;
            }
            
            .chart-container {
                height: 300px;
            }
        }

        /* Loading Animation */
        .loading {
            color: var(--text-secondary);
            position: relative;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(5, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="dashboard-header">
            <h1><i class="fas fa-chart-line me-2"></i>Biomechanical Sensor Analysis</h1>
        </div>

        <form id="login-form" class="mx-auto" style="max-width: 400px;">
            <h2 class="text-center"><i class="fas fa-user-circle mb-3"></i> Login</h2>
            <div class="mb-3">
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                    <input type="email" id="email" class="form-control" placeholder="Email" required />
                </div>
            </div>
            <div class="mb-3">
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-lock"></i></span>
                    <input type="password" id="password" class="form-control" placeholder="Password" required />
                </div>
            </div>
            <button type="submit" class="btn btn-primary w-100">
                <i class="fas fa-sign-in-alt me-2"></i>Login
            </button>
        </form>

        <div id="data-container" style="display: none;">
            <div class="d-flex justify-content-end mb-3">
                <button id="logout-button" class="btn btn-danger">
                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                </button>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="biomech-section">
                        <h3><i class="fas fa-walking me-2"></i>Gait Analysis</h3>
                        <div class="mb-3">
                            <label for="user-weight" class="form-label">Enter Your Weight (kg):</label>
                            <div class="weight-input-group">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-weight"></i></span>
                                    <input type="number" id="user-weight" class="form-control" placeholder="e.g. 70" min="1" required>
                                </div>
                                <button type="button" id="update-weight-button" class="btn btn-primary">
                                    <i class="fas fa-sync-alt me-2"></i>Update
                                </button>
                            </div>
                        </div>
                        <div id="phase-display" class="data-display">
                            <i class="fas fa-running me-2"></i>Phase: <span class="loading">Loading</span>
                        </div>
                        <div id="knee-force-display" class="data-display">
                            <i class="fas fa-compress-arrows-alt me-2"></i>Knee Joint Force: <span class="loading">Loading</span>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="biomech-section">
                        <h3><i class="fas fa-compass me-2"></i>Angular Measurements</h3>
                        <div id="femur-angular-velocity-display" class="data-display">
                            <i class="fas fa-tachometer-alt me-2"></i>Femur Angular Velocity: <span class="loading">Loading</span>
                        </div>
                        <div id="tibia-angular-velocity-display" class="data-display">
                            <i class="fas fa-tachometer-alt me-2"></i>Tibia Angular Velocity: <span class="loading">Loading</span>
                        </div>
                        <div id="angular-acceleration-display" class="data-display">
                            <i class="fas fa-bolt me-2"></i>Angular Acceleration: <span class="loading">Loading</span>
                        </div>
                        <div id="joint-torque-display" class="data-display">
                            <i class="fas fa-sync me-2"></i>Knee Joint Torque: <span class="loading">Loading</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="biomech-section">
                <h3><i class="fas fa-arrows-alt me-2"></i>Segment Orientations</h3>
                <div class="row">
                    <div class="col-md-6">
                        <h4 class="text-center mb-3">
                            <i class="fas fa-bone me-2"></i>Femur Orientation
                        </h4>
                        <div id="femur-pitch-display" class="data-display">
                            <i class="fas fa-angle-double-up me-2"></i>Femur Pitch: <span class="loading">Loading</span>
                        </div>
                        <div id="femur-roll-display" class="data-display">
                            <i class="fas fa-sync-alt me-2"></i>Femur Roll: <span class="loading">Loading</span>
                        </div>
                        <div id="femur-yaw-display" class="data-display">
                            <i class="fas fa-redo me-2"></i>Femur Yaw: <span class="loading">Loading</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h4 class="text-center mb-3">
                            <i class="fas fa-bone me-2"></i>Tibia Orientation
                        </h4>
                        <div id="tibia-pitch-display" class="data-display">
                            <i class="fas fa-angle-double-up me-2"></i>Tibia Pitch: <span class="loading">Loading</span>
                        </div>
                        <div id="tibia-roll-display" class="data-display">
                            <i class="fas fa-sync-alt me-2"></i>Tibia Roll: <span class="loading">Loading</span>
                        </div>
                        <div id="tibia-yaw-display" class="data-display">
                            <i class="fas fa-redo me-2"></i>Tibia Yaw: <span class="loading">Loading</span>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <div id="knee-flexion-display" class="data-display">
                            <i class="fas fa-angle-double-right me-2"></i>Knee Flexion Angle: <span class="loading">Loading</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="chart-container">
                        <canvas id="femurAccelChart"></canvas>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="chart-container">
                        <canvas id="femurGyroChart"></canvas>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="chart-container">
                        <canvas id="tibiaAccelChart"></canvas>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="chart-container">
                        <canvas id="tibiaGyroChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="mb-0"><i class="fas fa-database me-2"></i>Raw Sensor Data</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-layer-group me-2"></i>Section</th>
                                    <th><i class="fas fa-microchip me-2"></i>Sensor Type</th>
                                    <th><i class="fas fa-stream me-2"></i>Data</th>
                                </tr>
                            </thead>
                            <tbody id="data-table">
                                <!-- Data will be dynamically populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html> 
